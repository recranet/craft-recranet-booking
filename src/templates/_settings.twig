{% set title = 'Settings' %}
{% set fullPageForm = true %}

{% extends "_layouts/cp.twig" %}
{% import "_includes/forms.twig" as forms %}

{% set tabs = {
    "general": { label: "General"|t('_recranet-booking'), url: "#general" },
    "sitemap": { label: "Sitemap"|t('_recranet-booking'), url: "#sitemap" },
} %}

{% block content %}
    <input type="hidden" name="action" value="_recranet-booking/settings/save-settings">

    {% set recranetBookingPlugin = craft.app.plugins.getPlugin('_recranet-booking') %}
    {% set settings = recranetBookingPlugin.getSettings() %}
    {% set organizationService = recranetBookingPlugin.getOrganizationService %}
    {% set unlinkedSites = organizationService.getUnlinkedSites() %}

    <div id="general">
        {% namespace 'general' %}
            {# @TODO: Show unlinked sites  #}
            {% for site in craft.app.sites.allSites() %}
                {{ dump(craft.app.globals().getSetByHandle('siteOrganization', site.id)) }}
            {% endfor %}
            {% for unlinkedSite in unlinkedSites %}
                {{ unlinkedSite }}
            {% endfor %}
        {% endnamespace %}
    </div>
    <div id="sitemap" class="hidden">
        {% namespace 'sitemap' %}
            {{ forms.lightswitchField({
                label: "Generate accommodations sitemap"|t("_recruitee"),
                id: "sitemapEnabled",
                name: "sitemapEnabled",
                tip: "If enabled, a sitemap will be generated for accommodations. <a class='go' href='/sitemap-accommodations.xml' rel='noopener' target='_blank'>Learn more</a>",
                on: settings.sitemapEnabled,
            }) }}
        {% endnamespace %}
    </div>
{% endblock %}
